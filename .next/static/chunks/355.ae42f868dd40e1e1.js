"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[355],{6115:(e,t,r)=>{var n=r(12115),o=r(49033),i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=o.useSyncExternalStore,a=n.useRef,c=n.useEffect,u=n.useMemo,l=n.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,n,o){var d=a(null);if(null===d.current){var h={hasValue:!1,value:null};d.current=h}else h=d.current;var g=s(e,(d=u(function(){function e(e){if(!c){if(c=!0,s=e,e=n(e),void 0!==o&&h.hasValue){var t=h.value;if(o(t,e))return a=t}return a=e}if(t=a,i(s,e))return t;var r=n(e);return void 0!==o&&o(t,r)?(s=e,t):(s=e,a=r)}var s,a,c=!1,u=void 0===r?null:r;return[function(){return e(t())},null===u?void 0:function(){return e(u())}]},[t,r,n,o]))[0],d[1]);return c(function(){h.hasValue=!0,h.value=g},[g]),l(g),g}},20355:(e,t,r)=>{r.r(t),r.d(t,{default:()=>C});var n=r(95155),o=r(12115),i=r(85980),s=r(35695),a=r(19946);let c=(0,a.A)("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),u=(0,a.A)("wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);var l=r(46459),d=r(87660),h=r(64997),g=r(48374),f=r(95782);class p extends f.C{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WagmiError"})}get docsBaseUrl(){return"https://wagmi.sh/react"}get version(){return"wagmi@2.16.3"}}class b extends p{constructor(){super("`useConfig` must be used within `WagmiProvider`.",{docsPath:"/api/WagmiProvider"}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WagmiProviderNotFoundError"})}}function m(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=null!=(e=t.config)?e:(0,o.useContext)(g.R);if(!r)throw new b;return r}var v=r(34250),E=r(45643);let O=e=>"object"==typeof e&&!Array.isArray(e);var y=r(34560),x=r(7165),W=r(25910),k=r(52020),w=class extends W.Q{#e;#t=void 0;#r;#n;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#o()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,k.f8)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,k.EN)(t.mutationKey)!==(0,k.EN)(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#o(),this.#i(e)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#o(),this.#i()}mutate(e,t){return this.#n=t,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(e)}#o(){let e=this.#r?.state??(0,y.$)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#i(e){x.jG.batch(()=>{if(this.#n&&this.hasListeners()){let t=this.#t.variables,r=this.#t.context;e?.type==="success"?(this.#n.onSuccess?.(e.data,t,r),this.#n.onSettled?.(e.data,null,t,r)):e?.type==="error"&&(this.#n.onError?.(e.error,t,r),this.#n.onSettled?.(void 0,e.error,t,r))}this.listeners.forEach(e=>{e(this.#t)})})}},T=r(26715),N=r(37968),S=r(72962),R=r(97587),B=r(49509);function C(){let[e,t]=(0,o.useState)(""),[r,a]=(0,o.useState)(!1),[g,f]=(0,o.useState)("idle"),{theme:p,addLog:b,currentDomain:y,domainData:W,authError:C,setAuthError:U,sessionData:A,setSessionData:L,navigate:M,isTerminating:G,web3LogoutPending:j,setWeb3LogoutPending:I}=(0,i.w)(),P=(0,s.useRouter)(),{open:H}=(0,l.JS)(),{address:D,isConnected:_}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=m(e);return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.b,i=(0,o.useRef)([]),s=(0,E.useSyncExternalStoreWithSelector)(e,t,r,e=>e,(e,t)=>{if(O(e)&&O(t)&&i.current.length){for(let r of i.current)if(!n(e[r],t[r]))return!1;return!0}return n(e,t)});return(0,o.useMemo)(()=>{if(O(s)){let e={...s},t={};for(let[r,n]of Object.entries(e))t={...t,[r]:{configurable:!1,enumerable:!0,get:()=>(i.current.includes(r)||i.current.push(r),n)}};return Object.defineProperties(e,t),e}return s},[s])}(e=>(0,d.F)(t,{onChange:e}),()=>(0,h.s)(t))}(),{disconnectAsync:F}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{mutation:t}=e,r=m(e),n={mutationFn:e=>(0,N.Z)(r,e),mutationKey:["disconnect"]},{mutate:i,mutateAsync:s,...a}=function(e,t){let r=(0,T.jE)(void 0),[n]=o.useState(()=>new w(r,e));o.useEffect(()=>{n.setOptions(e)},[n,e]);let i=o.useSyncExternalStore(o.useCallback(e=>n.subscribe(x.jG.batchCalls(e)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),s=o.useCallback((e,t)=>{n.mutate(e,t).catch(k.lQ)},[n]);if(i.error&&(0,k.GU)(n.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:s,mutateAsync:i.mutate}}({...t,...n});return{...a,connectors:(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=m(e);return(0,o.useSyncExternalStore)(e=>(0,S.b)(t,{onChange:e}),()=>(0,R.W)(t),()=>(0,R.W)(t))})({config:r}).map(e=>e.connector),disconnect:i,disconnectAsync:s}}(),K=(0,o.useRef)(!1),V=(0,o.useRef)(!1),z=(0,o.useRef)(null),q=(0,o.useRef)(!1),X=(0,o.useCallback)(async e=>{if(K.current){console.log("[WEB3 AUTH] Blocked: Logout in progress"),b("WEB3 LOGIN: Skipped - logout in progress");return}if(V.current)return void console.log("[WEB3 AUTH] Blocked: Already initialized");if(q.current)return void console.log("[WEB3 AUTH] Blocked: User intentionally logged out");console.log("[WEB3 AUTH] Starting authentication for:",e),V.current=!0,f("connecting"),b("WEB3 CONNECTED: ".concat(e));try{let r=await fetch("/api/session?code=0XDEFI2311");if(r.ok){var t;let n=await r.json(),o={...n,isWeb3User:!0,walletAddress:e,meta:{...n.meta,company:"Web3 User",accessMethod:"web3"},profile:{...n.profile,greeting_name:"Web3 User",summary:{...null==(t=n.profile)?void 0:t.summary,title:"Web3 Authenticated User",specialization:"Authenticated via Web3",background:"Decentralized Access"}}};L(o),b("WEB3 ACCESS GRANTED: ".concat(e)),f("connected"),M("MainHub",!1),P.push("/?web3=".concat(e))}else console.error("[WEB3 AUTH] Server returned error:",r.status),b("ERROR: Failed to create Web3 session"),U("Failed to authenticate with Web3. Please try again."),f("idle"),_&&await F(),V.current=!1}catch(e){if(console.error("[WEB3 AUTH] Exception during authentication:",e),b("ERROR: Web3 session creation failed"),U("Network error during Web3 authentication"),f("idle"),_)try{await F()}catch(e){console.error("[WEB3 AUTH] Error during cleanup disconnect:",e)}V.current=!1}},[_,F,L,b,M,P,U]);(0,o.useEffect)(()=>{if(console.log("[WEB3 DEBUG]",{isTerminating:G,web3LogoutPending:j,isLoggingOut:K.current,hasInitialized:V.current,intentionalLogout:q.current,isConnected:_,hasSession:!!A}),G)return void console.log("[WEB3 MONITOR] Session is terminating - skip all authentication");if(j)return void console.log("[WEB3 MONITOR] Web3 logout is pending - skip authentication");if(K.current)return void console.log("[WEB3 MONITOR] Logout in progress - skip authentication");if(q.current)return void console.log("[WEB3 MONITOR] Intentional logout detected - skip authentication");let e=null!==z.current&&!A;if(z.current=A,e)return void console.log("[WEB3 MONITOR] Session was cleared - likely logout");!_||!D||V.current||A||q.current||(console.log("[WEB3 MONITOR] All conditions met - starting authentication"),X(D)),!_&&(V.current||q.current)&&(console.log("[WEB3 MONITOR] Wallet disconnected - resetting all flags"),V.current=!1,q.current=!1,f("idle"))},[_,D,A,G,j,X]),(0,o.useEffect)(()=>{j&&_&&!K.current&&(console.log("[WEB3 LOGOUT] Processing pending logout from context state"),K.current=!0,q.current=!0,f("disconnecting"),(async()=>{b("WEB3 LOGOUT: Starting disconnect process");try{console.log("[WEB3 LOGOUT] Calling disconnectAsync..."),await F(),console.log("[WEB3 LOGOUT] disconnectAsync completed successfully"),b("WEB3 LOGOUT: Wallet disconnected successfully")}catch(e){console.error("[WEB3 LOGOUT] Error during disconnect:",e),b("WEB3 LOGOUT: Error during disconnect (continuing anyway)")}finally{I(!1),console.log("[WEB3 LOGOUT] Cleared web3LogoutPending flag")}})()),j&&!_&&(console.log("[WEB3 LOGOUT] Logout requested but wallet already disconnected"),I(!1),K.current=!1,q.current=!1,f("idle"))},[j,_,F,b,I]),(0,o.useEffect)(()=>{let e=()=>{console.log("[WEB3 LOGOUT] Legacy browser event received - ignoring (using state-based approach)")};return window.addEventListener("web3-logout-requested",e),()=>{window.removeEventListener("web3-logout-requested",e)}},[]),(0,o.useEffect)(()=>{if(!_&&K.current){console.log("[WEB3 LOGOUT] Wallet disconnection confirmed by wagmi");let e=setTimeout(()=>{K.current=!1,f("idle"),console.log("[WEB3 LOGOUT] Process completed and lock released"),b("WEB3 LOGOUT: Process completed")},200);return()=>clearTimeout(e)}},[_,b]);let Q=async()=>{if(!e.trim()){b("ERROR: No access code provided"),U("Please enter an access code");return}a(!0),U(null),b("AUTHENTICATING: ".concat(e)),P.push("/?code=".concat(e))};return(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value.toUpperCase()),onKeyPress:e=>{"Enter"!==e.key||r||_||Q()},className:"w-full p-3 mb-3 rounded font-mono text-lg tracking-wider ".concat("dark"===p?"bg-dark-input-bg text-dark-text-primary":"bg-light-input-bg text-light-text-primary"," border ").concat(C?"dark"===p?"border-dark-error":"border-light-error":"dark"===p?"border-dark-border":"border-light-border"," ").concat(C?"animate-pulse":""),placeholder:"ENTER ACCESS CODE",autoFocus:!0,disabled:r||_}),C&&(0,n.jsx)("div",{className:"mb-3 text-sm ".concat("dark"===p?"text-dark-error":"text-light-error"),children:C}),(0,n.jsx)("button",{onClick:Q,disabled:r||_,className:"w-full p-3 mb-3 border rounded transition-colors ".concat("dark"===p?"border-dark-border hover:bg-dark-hover text-dark-text-primary":"border-light-border hover:bg-light-hover text-light-text-primary"," ").concat(r||_?"opacity-50 cursor-not-allowed":""),children:r?"AUTHENTICATING...":"AUTHENTICATE"}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsxs)("button",{onClick:()=>{let e;e=(null==W?void 0:W.telegram)?W.telegram:B.env.NEXT_PUBLIC_DEFAULT_CONTACT_TELEGRAM||"https://t.me/example",b("EXTERNAL LINK: Telegram ".concat(e)),window.open(e,"_blank")},disabled:_,className:"flex-1 p-3 border rounded flex items-center justify-center gap-2 transition-colors ".concat("dark"===p?"border-dark-border hover:bg-dark-hover text-dark-text-primary":"border-light-border hover:bg-light-hover text-light-text-primary"," ").concat(_?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(c,{className:"w-4 h-4"}),"GET CODE"]}),(0,n.jsxs)("button",{onClick:()=>{if(_)return void b("WEB3 LOGIN: Already connected");b("WEB3 LOGIN: Opening wallet connection modal"),f("connecting"),H()},disabled:K.current||"disconnecting"===g||j,className:"flex-1 p-3 border rounded flex items-center justify-center gap-2 transition-colors ".concat("dark"===p?"border-dark-border hover:bg-dark-hover text-dark-text-primary":"border-light-border hover:bg-light-hover text-light-text-primary"," ").concat(K.current||"disconnecting"===g||j?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(u,{className:"w-4 h-4"}),_?"".concat(D.slice(0,6),"...").concat(D.slice(-4)):"connecting"===g?"CONNECTING...":"WEB3 LOGIN"]})]}),_&&"connecting"===g&&(0,n.jsx)("div",{className:"mt-2 text-center text-xs ".concat("dark"===p?"text-dark-text-secondary":"text-light-text-secondary"),children:"Processing Web3 authentication..."}),("disconnecting"===g||j)&&(0,n.jsx)("div",{className:"mt-2 text-center text-xs ".concat("dark"===p?"text-dark-text-secondary":"text-light-text-secondary"),children:"Disconnecting wallet..."})]})}},22436:(e,t,r)=>{var n=r(12115),o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=n.useState,s=n.useEffect,a=n.useLayoutEffect,c=n.useDebugValue;function u(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!o(e,r)}catch(e){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),n=i({inst:{value:r,getSnapshot:t}}),o=n[0].inst,l=n[1];return a(function(){o.value=r,o.getSnapshot=t,u(o)&&l({inst:o})},[e,r,t]),s(function(){return u(o)&&l({inst:o}),e(function(){u(o)&&l({inst:o})})},[e]),c(r),r};t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:l},45643:(e,t,r)=>{e.exports=r(6115)},49033:(e,t,r)=>{e.exports=r(22436)}}]);