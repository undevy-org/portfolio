"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4287],{16875:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(95155),c=n(12115),i=n(35888);function s(e){let{children:t,className:n="",noPadding:s=!1,testId:r="screen-wrapper"}=e,{currentScreen:l}=(0,i.wV)(),[a,d]=(0,c.useState)(!1);(0,c.useEffect)(()=>(d(!0),()=>d(!1)),[]);let u="\n    screen-wrapper\n    w-full\n    min-h-full\n    relative\n    ".concat(!s?"p-4":"","\n    ").concat(n,"\n  ");return(0,o.jsx)("div",{className:"".concat(u," ").concat((()=>{switch(l){case"Entry":return"flex items-center justify-center";case"ProfileBoot":return"flex flex-col justify-center";case"CaseDetail":case"SkillDetail":case"RoleDetail":return"space-y-4";default:return""}})()).trim(),...{"data-testid":r,"data-screen":l,"data-mounted":a},children:t})}},34287:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var o=n(95155),c=n(12115),i=n(35888);n(16875);var s=n(35695),r=n(50430),l=n(81497),a=n(39785),d=n(59099),u=n(53311),g=n(46459),E=n(2145),f=n(52200),m=n(73231);function O(){let[e,t]=(0,c.useState)(""),[n,O]=(0,c.useState)(!1),[p,h]=(0,c.useState)("idle"),{theme:W,addLog:N,currentDomain:T,domainData:x,authError:w,setAuthError:y,sessionData:B,setSessionData:b,navigate:A,isTerminating:v,web3LogoutPending:U,setWeb3LogoutPending:L}=(0,i.wV)(),k=(0,s.useRouter)(),{open:R}=(0,g.JS)(),{address:C,isConnected:G}=(0,E.F)(),{disconnectAsync:D}=(0,f.u)(),I=(0,c.useRef)(!1),M=(0,c.useRef)(!1),j=(0,c.useRef)(null),S=(0,c.useRef)(!1),H=(0,c.useCallback)(async e=>{if(I.current){console.log("[WEB3 AUTH] Blocked: Logout in progress"),N("WEB3 LOGIN: Skipped - logout in progress");return}if(M.current)return void console.log("[WEB3 AUTH] Blocked: Already initialized");if(S.current)return void console.log("[WEB3 AUTH] Blocked: User intentionally logged out");console.log("[WEB3 AUTH] Starting authentication for:",e),M.current=!0,h("connecting"),N("WEB3 CONNECTED: ".concat(e));try{let n=await fetch("/api/session?code=0XDEFI2311");if(n.ok){var t;let o=await n.json(),c={...o,isWeb3User:!0,walletAddress:e,meta:{...o.meta,company:"Web3 User",accessMethod:"web3"},profile:{...o.profile,greeting_name:"Web3 User",summary:{...null==(t=o.profile)?void 0:t.summary,title:"Web3 Authenticated User",specialization:"Authenticated via Web3",background:"Decentralized Access"}}};b(c),N("WEB3 ACCESS GRANTED: ".concat(e)),h("connected"),A("MainHub",!1),k.push("/?web3=".concat(e))}else console.error("[WEB3 AUTH] Server returned error:",n.status),N("ERROR: Failed to create Web3 session"),y("Failed to authenticate with Web3. Please try again."),h("idle"),G&&await D(),M.current=!1}catch(e){if(console.error("[WEB3 AUTH] Exception during authentication:",e),N("ERROR: Web3 session creation failed"),y("Network error during Web3 authentication"),h("idle"),G)try{await D()}catch(e){console.error("[WEB3 AUTH] Error during cleanup disconnect:",e)}M.current=!1}},[G,D,b,N,A,k,y]);(0,c.useEffect)(()=>{if(console.log("[WEB3 DEBUG]",{isTerminating:v,web3LogoutPending:U,isLoggingOut:I.current,hasInitialized:M.current,intentionalLogout:S.current,isConnected:G,hasSession:!!B}),v)return void console.log("[WEB3 MONITOR] Session is terminating - skip all authentication");if(U)return void console.log("[WEB3 MONITOR] Web3 logout is pending - skip authentication");if(I.current)return void console.log("[WEB3 MONITOR] Logout in progress - skip authentication");if(S.current)return void console.log("[WEB3 MONITOR] Intentional logout detected - skip authentication");let e=null!==j.current&&!B;if(j.current=B,e)return void console.log("[WEB3 MONITOR] Session was cleared - likely logout");!G||!C||M.current||B||S.current||(console.log("[WEB3 MONITOR] All conditions met - starting authentication"),H(C)),!G&&(M.current||S.current)&&(console.log("[WEB3 MONITOR] Wallet disconnected - resetting all flags"),M.current=!1,S.current=!1,h("idle"))},[G,C,B,v,U,H]),(0,c.useEffect)(()=>{U&&G&&!I.current&&(console.log("[WEB3 LOGOUT] Processing pending logout from context state"),I.current=!0,S.current=!0,h("disconnecting"),(async()=>{N("WEB3 LOGOUT: Starting disconnect process");try{console.log("[WEB3 LOGOUT] Calling disconnectAsync..."),await D(),console.log("[WEB3 LOGOUT] disconnectAsync completed successfully"),N("WEB3 LOGOUT: Wallet disconnected successfully")}catch(e){console.error("[WEB3 LOGOUT] Error during disconnect:",e),N("WEB3 LOGOUT: Error during disconnect (continuing anyway)")}finally{L(!1),console.log("[WEB3 LOGOUT] Cleared web3LogoutPending flag")}})()),U&&!G&&(console.log("[WEB3 LOGOUT] Logout requested but wallet already disconnected"),L(!1),I.current=!1,S.current=!1,h("idle"))},[U,G,D,N,L]),(0,c.useEffect)(()=>{let e=()=>{console.log("[WEB3 LOGOUT] Legacy browser event received - ignoring (using state-based approach)")};return window.addEventListener("web3-logout-requested",e),()=>{window.removeEventListener("web3-logout-requested",e)}},[]),(0,c.useEffect)(()=>{if(!G&&I.current){console.log("[WEB3 LOGOUT] Wallet disconnection confirmed by wagmi");let e=setTimeout(()=>{I.current=!1,h("idle"),console.log("[WEB3 LOGOUT] Process completed and lock released"),N("WEB3 LOGOUT: Process completed")},200);return()=>clearTimeout(e)}},[G,N]);let P=async()=>{if(!e.trim()){N("ERROR: No access code provided"),y("Please enter an access code");return}O(!0),y(null),N("AUTHENTICATING: ".concat(e)),k.push("/?code=".concat(e))},z=async()=>{N("DEMO MODE: Initializing demo session"),O(!0),y(null);try{let e=await fetch("/api/session");if(e.ok){let t={...await e.json(),isDemoMode:!0,accessCode:"DEMO"};b(t),N("DEMO MODE: Session initialized"),A("ProfileBoot",!1)}else N("DEMO MODE: Failed to initialize"),y("Demo mode is not available at this time")}catch(e){N("DEMO MODE ERROR: ".concat(e.message)),y("Failed to start demo mode. Please try again.")}finally{O(!1)}};return(0,o.jsxs)("div",{className:"p-4",children:[(0,o.jsxs)("div",{className:"flex flex-col md:flex-row gap-3 mb-3",children:[(0,o.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value.toUpperCase()),onKeyPress:e=>{"Enter"!==e.key||n||G||P()},className:"input-base flex-1 text-sm min-h-[3rem] tracking-wider ".concat(w?"input-error animate-pulse":""),placeholder:"ENTER ACCESS CODE",autoFocus:!0,disabled:n||G}),(0,o.jsx)(m.A,{onClick:P,disabled:n||G,icon:r.A,variant:"inline",className:"md:w-auto w-full",children:(0,o.jsx)("span",{className:"flex items-center gap-2",children:n?"AUTHENTICATING...":"AUTHENTICATE"})})]}),w&&(0,o.jsx)("div",{className:"mb-3 text-sm text-error",children:w}),(0,o.jsxs)("div",{className:"flex gap-3 mb-4",children:[(0,o.jsx)(m.A,{onClick:()=>{let e;e=(null==x?void 0:x.telegram)?x.telegram:"@testuser",N("EXTERNAL LINK: Telegram ".concat(e)),window.open(e,"_blank")},disabled:G,icon:l.A,className:"flex-1",children:"GET CODE"}),(0,o.jsx)(m.A,{onClick:()=>{if(G)return void N("WEB3 LOGIN: Already connected");N("WEB3 LOGIN: Opening wallet connection modal"),h("connecting"),R()},disabled:I.current||"disconnecting"===p||U,icon:a.A,className:"flex-1",children:G?"".concat(C.slice(0,6),"...").concat(C.slice(-4)):"connecting"===p?"CONNECTING...":"WEB3 LOGIN"})]}),(0,o.jsx)("div",{className:"border-t border-secondary opacity-50 my-4"}),(0,o.jsxs)("div",{className:"flex gap-3",children:[(0,o.jsx)(m.A,{onClick:()=>{N("EXTERNAL LINK: GitHub"),window.open("https://github.com/undevy-org/portfolio","_blank")},icon:d.A,className:"flex-1",children:"GITHUB"}),(0,o.jsx)(m.A,{onClick:z,icon:u.A,className:"flex-1",children:"DEMO MODE"})]}),G&&"connecting"===p&&(0,o.jsx)("div",{className:"mt-2 text-center text-xs text-secondary",children:"Processing Web3 authentication..."}),("disconnecting"===p||U)&&(0,o.jsx)("div",{className:"mt-2 text-center text-xs text-secondary",children:"Disconnecting wallet..."})]})}}}]);